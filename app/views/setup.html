<div class="step-wrapper">

    <!-- each step -->
    <div ng-repeat="step in steps" ng-class="step.style" class="step">

        <!-- title-->
        <div class="title-wrapper">
            <h1 class="title"> Step{{ $index + 1 }}. {{ step.title }} </h1>
            <div ng-if="step.style=='done'" class="result">
                <span class="glyphicon glyphicon-ok"></span>
                {{ step.result }}
                <span><a ng-click="revertStepTo($index)">Edit</a>
            </div>
        </div>

        <!-- step 0. select year -->
        <div ng-if="$index == 0" data-data="validYear" class="content">
            <div class="btn-group" uib-dropdown is-open="status.isopen">
                <button id="year-button" type="button" class="btn btn-primary" uib-dropdown-toggle ng-disabled="disabled">
                    Available Years <span class="caret"></span>
                </button>
                <ul uib-dropdown-menu role="menu" aria-labelledby="year-button">
                    <li role="menuitem" ng-repeat="year in validYear"><a ng-click="loadFile(year)">{{ year }}</a></li>
                </ul>
            </div>
        </div>

        <!-- step >1. select places -->
        <div ng-if="$index >= 1 && $index < steps.length - 1" class="content">
            <ol>
                <li ng-repeat="p in candidates[step.label]">
                    <input type="checkbox" ng-model="selected[step.label][$index]">
                    {{ p.name }} / {{ p.humanTime }} / {{ p.count }} days
                    <span><a ng-click="recenterMap([$index])">map</a></span>
                    <span><a ng-click="isLocationEditCollapsed = !isLocationEditCollapsed">edit</a></span>
                    <div ng-hide="isLocationEditCollapsed">
                        <input type="text" class="form-control" ng-model="newLocationNames[$index]" placeholder=" Enter a new name" ng-click="clearLocationName($index)">
                        <button type="button" class="btn btn-primary" ng-click="updateLocationName($index, step.label); isLocationEditCollapsed = true">Edit</button>
                    </div>
                </li>
            </ol>
            <p><a class="btn btn-success" ng-click="completeStep($parent.$index)">Done <span class="glyphicon glyphicon-ok"></span></a></p>
        </div>

        <!-- last step. merge uplicates -->
        <div ng-if="$index == steps.length-1" class="content">
            <ul>
                <li ng-repeat="d in duplicates" ng-class="mergingAt == $index? 'active' : ''">
                    <div>
                        {{ d[0].name }} ({{ d.length }})
                        <span ng-show="d.length == 1">
                            Done
                            <a ng-click="editMergedPlaces($index)">Edit</a>
                        </span>
                        <span ng-show="mergingAt !== $index && d.length > 1"><a ng-click="mergeAt($index)">locate</a></span>
                    </div>
                    <div ng-show="d.length > 1 && mergingAt == $index">
                        <span ng-repeat="p in d">
                            <input type="checkbox" ng-model="merged[$parent.$index][p.id]">
                            {{ p.count }} days
                        </span>
                        <span ng-class="isReadyToMerge($index) ? '' : 'disabled'">
                            <a ng-click="isReadyToMerge($index) && mergeDuplicates($index)">merge</a>
                        </span>
                    </div>
                </li>
            </ul>
            <p><a class="btn btn-success" ng-click="completeStep($index)">Done <span class="glyphicon glyphicon-ok"></span></a></p>
        </div>
    </div>

    <!-- done with all steps -->
    <p ng-if="done"><a class="btn btn-lg btn-success" ng-href="#/vis">Visualize <span class="glyphicon glyphicon-ok"></span></a></p>
</div>

<!-- map -->
<leaflet markers="map.markers" lf-center="map.center" class="map"></leaflet>